<p-toast></p-toast>
<p-card header="Seller Orders" styleClass="shadow-2xl">
  <div class="mb-3 flex flex-col md:flex-row md:items-center gap-4">
    <div class="flex items-center gap-4">
      <label for="statusFilter" class="font-semibold">Filter by Status:</label>
      <p-dropdown
        inputId="statusFilter"
        [options]="[
          {label: 'All', value: ''},
          {label: 'Pending', value: 'Pending'},
          {label: 'Processing', value: 'Processing'},
          {label: 'Ready', value: 'Ready'},
          {label: 'Shipped', value: 'Shipped'},
          {label: 'Completed', value: 'Completed'},
          {label: 'Cancelled', value: 'Cancelled'},
          {label: 'Delivered', value: 'Delivered'}
        ]"
        [(ngModel)]="statusFilter"
        placeholder="Select Status"
        (onChange)="dt.filter(statusFilter, 'status', 'equals')"
        styleClass="w-40"
      ></p-dropdown>
    </div>
    <span class="ml-auto">
      <input pInputText type="text" [(ngModel)]="globalFilter" (ngModelChange)="dt.filterGlobal($event, 'contains')" placeholder="Search orders, buyers, products..." class="p-inputtext-sm w-64" />
    </span>
  </div>
  <p-table #dt [value]="orders" [loading]="loading" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]"
    [globalFilterFields]="['buyerFirstName', 'buyerLastName', 'sellerFirstName', 'sellerLastName', 'status', 'orderType', 'productId', 'stockId']"
    [filters]="{ status: { value: statusFilter, matchMode: 'equals' } }"
    class="shadow-lg rounded-xl">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">Order #<p-sortIcon field="id" /></th>
        <th pSortableColumn="craetedAt">Date<p-sortIcon field="craetedAt" /></th>
        <th>Product</th>
        <th>Stock</th>
        <th>Buyer</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-order>
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.craetedAt | date:'short' }}</td>
        <td>
          <span class="flex items-center gap-2">
            <i class="pi pi-box text-blue-500"></i>
            <span class="font-semibold">#{{ order.productId }}</span>
          </span>
        </td>
        <td>
          <span class="flex items-center gap-2">
            <i class="pi pi-tag text-green-500"></i>
            <span class="font-semibold">#{{ order.stockId }}</span>
          </span>
        </td>
        <td>
          <span class="flex items-center gap-2">
            <span class="inline-block w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold">
              {{ order.buyerFirstName[0] }}{{ order.buyerLastName[0] }}
            </span>
            <span>{{ order.buyerFirstName }} {{ order.buyerLastName }}</span>
          </span>
        </td>
        <td>{{ order.quantity }}</td>
        <td>{{ order.price | currency }}</td>
        <td>
          <span class="p-badge px-3 py-2 text-base" [ngClass]="{
            'p-badge-info': order.status === 'Pending',
            'p-badge-warning': order.status === 'Processing',
            'p-badge-success': order.status === 'Ready',
            'p-badge-danger': order.status === 'Cancelled',
            'p-badge-secondary': ['Shipped','Completed','Delivered'].includes(order.status)
          }" pTooltip="Order is {{order.status}}">
            {{ order.status }}
          </span>
        </td>
        <td>
          <div class="flex flex-wrap gap-2">
            <ng-container *ngIf="!isReadOnly(order)">
              <p-button *ngIf="canConfirm(order)" label="Confirm" icon="pi pi-check" size="small" styleClass="p-button-success" (onClick)="updateStatus(order, 'Processing')" pTooltip="Confirm and start processing"></p-button>
              <p-button *ngIf="canReject(order)" label="Reject" icon="pi pi-times" size="small" styleClass="p-button-danger" (onClick)="updateStatus(order, 'Cancelled')" pTooltip="Reject and cancel order"></p-button>
              <p-button *ngIf="canSetReady(order)" label="Set Ready" icon="pi pi-box" size="small" styleClass="p-button-info" (onClick)="updateStatus(order, 'Ready')" pTooltip="Mark as ready for shipping"></p-button>
              <p-button *ngIf="canCancel(order)" label="Cancel" icon="pi pi-ban" size="small" styleClass="p-button-warning" (onClick)="updateStatus(order, 'Cancelled')" pTooltip="Cancel order"></p-button>
            </ng-container>
            <ng-container *ngIf="isReadOnly(order)">
              <span class="text-gray-400">Read Only</span>
            </ng-container>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9">No orders found.</td>
      </tr>
    </ng-template>
  </p-table>
</p-card> 